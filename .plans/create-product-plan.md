│ Plan to implement                                                                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Plan: Create Product Feature                                                                                                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Context                                                                                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ The app has auth working but no product CRUD. The frontend has a placeholder CreateProduct.tsx page (form logs to console) and mock product data. The backend has no Product model, routes, or controllers. The upload middleware (Multer + Cloudinary) already exists at backend/src/middleware/upload.ts. This plan implements the full create product flow — backend   │
│ API + frontend form with category autocomplete and multi-image upload — plus comprehensive tests.                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                                                                                                                                                                                       │
│ Backend Implementation                                                                                                                                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 1. Create backend/src/models/Product.ts — Mongoose Product model                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - IProduct interface extending Document: title, description, price, images: string[], category, condition (enum 'New' | 'Like New' | 'Good' | 'Fair'), seller (ObjectId ref to 'User'), timestamps                                                                                                                                                                        │
│ - Schema validators: title (required, trim, 3-100 chars), description (required, trim, 10-2000 chars), price (required, min 0.01), images (required, validate array length 1-5), condition (required, enum), seller (required, ref User)                                                                                                                                  │
│ - timestamps: true                                                                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 2. Create backend/src/controllers/productController.ts — Two controllers                                                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - createProduct: Extract fields from req.body, get files from req.files as Express.Multer.File[], validate at least 1 image exists, upload all to Cloudinary via uploadToCloudinary(file.buffer, 'products') with Promise.all, create Product document with seller: req.user!.userId, populate seller name, respond 201 with product data                                 │
│ - getCategories: Product.distinct('category'), sort alphabetically, respond 200                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 3. Create backend/src/routes/productRoutes.ts — Route definitions                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Zod schema for create: title (string, 3-100), description (string, 10-2000), price (string with positive number refinement — multipart sends strings), category (string, 1-50), condition (enum)                                                                                                                                                                        │
│ - POST / — protect → upload.array('images', 5) → validate(schema) → createProduct                                                                                                                                                                                                                                                                                         │
│ - GET /categories — getCategories (public)                                                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 4. Modify backend/src/routes/index.ts — Register product routes                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Import productRoutes, add router.use('/products', productRoutes)                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                                                                                                                                                                                       │
│ Frontend Implementation                                                                                                                                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 5. Create frontend/src/services/productService.ts — API service layer                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Follow authService.ts pattern                                                                                                                                                                                                                                                                                                                                           │
│ - create(data): Build FormData with title, description, price, category, condition, and multiple images; POST to /products with multipart/form-data header                                                                                                                                                                                                                │
│ - getCategories(): GET /products/categories, returns { success, message, data: string[] }                                                                                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 6. Create frontend/src/components/common/CategoryAutocomplete.tsx                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Props: value, onChange, error?, required?                                                                                                                                                                                                                                                                                                                               │
│ - Fetches categories from productService.getCategories() on mount, caches in state                                                                                                                                                                                                                                                                                        │
│ - Text input that filters fetched categories as user types, shows dropdown suggestions below                                                                                                                                                                                                                                                                              │
│ - User can type any new category (free text, not limited to existing)                                                                                                                                                                                                                                                                                                     │
│ - Keyboard navigation: arrow keys to highlight, Enter to select, Escape to close                                                                                                                                                                                                                                                                                          │
│ - Close dropdown on blur (with short delay for click registration)                                                                                                                                                                                                                                                                                                        │
│ - Styling matches existing Input component: bg-dark-elevated, border-dark-border, orange focus ring, error state                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 7. Create frontend/src/components/common/ImageUpload.tsx                                                                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Props: images: File[], onChange: (images: File[]) => void, maxImages? (default 5), error?                                                                                                                                                                                                                                                                               │
│ - Grid of image previews via URL.createObjectURL (cleanup with URL.revokeObjectURL on unmount/removal)                                                                                                                                                                                                                                                                    │
│ - Remove button (X) on each preview                                                                                                                                                                                                                                                                                                                                       │
│ - Add button/dropzone shown when < maxImages; hidden <input type="file" accept="image/*" multiple> triggered by it                                                                                                                                                                                                                                                        │
│ - Client-side validation: image mimetype, 5MB size limit per file                                                                                                                                                                                                                                                                                                         │
│ - Dark theme styling consistent with rest of app                                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 8. Modify frontend/src/pages/CreateProduct.tsx — Full rework                                                                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - State: formData with title, description, price, category, condition, images: File[]                                                                                                                                                                                                                                                                                     │
│ - Add isSubmitting state                                                                                                                                                                                                                                                                                                                                                  │
│ - Add condition select dropdown (New, Like New, Good, Fair)                                                                                                                                                                                                                                                                                                               │
│ - Replace category <select> with <CategoryAutocomplete>                                                                                                                                                                                                                                                                                                                   │
│ - Replace single file input with <ImageUpload> component                                                                                                                                                                                                                                                                                                                  │
│ - Client-side validation: all required fields, at least 1 image, max 5 images                                                                                                                                                                                                                                                                                             │
│ - Submit: call productService.create(), handle success (navigate to /products/${id}), handle AxiosError with error message display (same pattern as Login.tsx)                                                                                                                                                                                                            │
│ - Show "Creating..." loading state on button while submitting                                                                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                                                                                                                                                                                       │
│ Tests                                                                                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 9. Create backend/tests/product.test.ts — Backend integration tests                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Follow the pattern from backend/tests/auth.test.ts: set env vars before imports, mock cloudinary uploads, use supertest.                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Setup:                                                                                                                                                                                                                                                                                                                                                                    │
│ - Set all env vars at top (same as auth.test.ts)                                                                                                                                                                                                                                                                                                                          │
│ - Mock uploadToCloudinary to return fake URLs instead of actually uploading                                                                                                                                                                                                                                                                                               │
│ - Register + verify a user in beforeAll to get an auth token                                                                                                                                                                                                                                                                                                              │
│ - Clean up Product and User collections in afterAll                                                                                                                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Test cases:                                                                                                                                                                                                                                                                                                                                                               │
│ - POST /api/products — creates product with valid data and auth token → 201, response has all fields                                                                                                                                                                                                                                                                      │
│ - POST /api/products — returns 401 without auth token                                                                                                                                                                                                                                                                                                                     │
│ - POST /api/products — returns 401 with invalid auth token                                                                                                                                                                                                                                                                                                                │
│ - POST /api/products — returns 400 when required fields missing (no title, no description, etc.)                                                                                                                                                                                                                                                                          │
│ - POST /api/products — returns 400 when title too short (< 3 chars)                                                                                                                                                                                                                                                                                                       │
│ - POST /api/products — returns 400 when description too short (< 10 chars)                                                                                                                                                                                                                                                                                                │
│ - POST /api/products — returns 400 when price is not a positive number                                                                                                                                                                                                                                                                                                    │
│ - POST /api/products — returns 400 when condition is invalid enum value                                                                                                                                                                                                                                                                                                   │
│ - POST /api/products — returns 400 when no images attached                                                                                                                                                                                                                                                                                                                │
│ - POST /api/products — returns 400 when > 5 images attached (Multer limit)                                                                                                                                                                                                                                                                                                │
│ - GET /api/products/categories — returns empty array when no products exist                                                                                                                                                                                                                                                                                               │
│ - GET /api/products/categories — returns distinct categories sorted alphabetically after products are created                                                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 10. Modify frontend/src/mocks/handlers.ts — Add product mock handlers                                                                                                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Add in-memory products array and defaultCategories list                                                                                                                                                                                                                                                                                                                 │
│ - POST /api/products — check auth header, parse FormData, return mock product with 201                                                                                                                                                                                                                                                                                    │
│ - GET /api/products/categories — return merged default + product categories sorted                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 11. Create frontend/tests/unit/productService.test.ts — Unit tests                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Follow authService.test.ts pattern: test each service method with MSW overrides.                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Test cases:                                                                                                                                                                                                                                                                                                                                                               │
│ - create — sends FormData and returns success response with product data                                                                                                                                                                                                                                                                                                  │
│ - create — returns 401 when not authenticated                                                                                                                                                                                                                                                                                                                             │
│ - create — returns 400 for validation errors                                                                                                                                                                                                                                                                                                                              │
│ - getCategories — returns array of category strings                                                                                                                                                                                                                                                                                                                       │
│ - getCategories — returns empty array when no categories exist                                                                                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 12. Create frontend/tests/integration/CreateProduct.test.tsx — Integration tests                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Follow Login.test.tsx / Register.test.tsx patterns: render with MemoryRouter, use MSW for API responses, mock useNavigate.                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Test cases:                                                                                                                                                                                                                                                                                                                                                               │
│ - Renders form with all fields: title, description, price, category, condition, image upload, submit button                                                                                                                                                                                                                                                               │
│ - Shows validation errors for empty required fields on submit                                                                                                                                                                                                                                                                                                             │
│ - Shows "Title is required" when submitting without title                                                                                                                                                                                                                                                                                                                 │
│ - Shows "Description is required" when submitting without description                                                                                                                                                                                                                                                                                                     │
│ - Shows "Price is required" when submitting without price                                                                                                                                                                                                                                                                                                                 │
│ - Shows "Category is required" when submitting without category                                                                                                                                                                                                                                                                                                           │
│ - Shows "Condition is required" when submitting without condition                                                                                                                                                                                                                                                                                                         │
│ - Shows "At least one image is required" when submitting without images                                                                                                                                                                                                                                                                                                   │
│ - Shows "Creating..." while submitting (loading state)                                                                                                                                                                                                                                                                                                                    │
│ - Successful submission navigates to product detail page                                                                                                                                                                                                                                                                                                                  │
│ - Failed submission (server error) shows error message in form                                                                                                                                                                                                                                                                                                            │
│ - Cancel button links to /profile                                                                                                                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 13. Create frontend/tests/e2e/createProduct.spec.ts — E2E tests                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Follow auth.spec.ts pattern: Playwright tests against running app.                                                                                                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Test cases:                                                                                                                                                                                                                                                                                                                                                               │
│ - Unauthenticated user visiting /create-product is redirected to /login                                                                                                                                                                                                                                                                                                   │
│ - Shows validation errors for empty fields on submit                                                                                                                                                                                                                                                                                                                      │
│ - Form renders all required fields (title, description, price, category, condition, images)                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 14. Backend security tests in backend/tests/product.test.ts                                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Additional security-focused test cases (in same file as step 9):                                                                                                                                                                                                                                                                                                          │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Rejects non-image file uploads (e.g., .txt, .pdf)                                                                                                                                                                                                                                                                                                                       │
│ - Rejects files exceeding 5MB size limit                                                                                                                                                                                                                                                                                                                                  │
│ - Product seller field is set from JWT, not from request body (cannot spoof seller)                                                                                                                                                                                                                                                                                       │
│ - XSS: HTML/script tags in title/description are stored as-is but validated by length (no injection into response since JSON API)                                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ ---                                                                                                                                                                                                                                                                                                                                                                       │
│ Reusable Code References                                                                                                                                                                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ - Upload middleware: backend/src/middleware/upload.ts — upload (multer instance) and uploadToCloudinary(buffer, folder)                                                                                                                                                                                                                                                   │
│ - Auth middleware: backend/src/middleware/authMiddleware.ts — protect                                                                                                                                                                                                                                                                                                     │
│ - Validation middleware: backend/src/middleware/validate.ts — validate(zodSchema)                                                                                                                                                                                                                                                                                         │
│ - Error class: backend/src/middleware/errorHandler.ts — AppError(message, statusCode)                                                                                                                                                                                                                                                                                     │
│ - Frontend components: Input, Button, Card from frontend/src/components/common/                                                                                                                                                                                                                                                                                           │
│ - API client: frontend/src/services/api.ts                                                                                                                                                                                                                                                                                                                                │
│ - MSW server: frontend/src/mocks/server.ts                                                                                                                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Implementation Order                                                                                                                                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ 1. Backend: model → controller → routes → register in index.ts                                                                                                                                                                                                                                                                                                            │
│ 2. Backend tests (with mocked Cloudinary)                                                                                                                                                                                                                                                                                                                                 │
│ 3. Frontend: MSW handlers → service → CategoryAutocomplete → ImageUpload → rework CreateProduct page                                                                                                                                                                                                                                                                      │
│ 4. Frontend tests: unit → integration → E2E                                                                                                                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ Verification                                                                                                                                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                                                                                                                                                           │
│ npm run build -w backend        # TypeScript compiles                                                                                                                                                                                                                                                                                                                     │
│ npm run lint -w backend         # No lint errors                                                                                                                                                                                                                                                                                                                          │
│ npm run test -w backend         # All backend tests pass (requires MongoDB)                                                                                                                                                                                                                                                                                               │
│ npm run build -w frontend       # TypeScript compiles                                                                                                                                                                                                                                                                                                                     │
│ npm run lint -w frontend        # No lint errors                                                                                                                                                                                                                                                                                                                          │
│ npm run test -w frontend        # All frontend tests pass                                                                                                                                                                                                                                                                                                                 │
│ npm run test:e2e -w frontend    # E2E tests pass         